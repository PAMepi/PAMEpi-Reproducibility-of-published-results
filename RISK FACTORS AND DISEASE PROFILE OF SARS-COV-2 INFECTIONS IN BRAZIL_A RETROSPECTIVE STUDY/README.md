# <img src="https://github.com/PAMepi/PAMepi_scripts_datalake/blob/main/Images/logo.png" width="80"/>  Reproducibility of published results: 

## Risk factors and disease profile of COVID-19 in Brazil: a retrospective study of 15,663,203 cases and 584,761 deaths

[![DOI](https://zenodo.org/badge/396775199.svg)](https://doi.org/10.5281/zenodo.6385254)

Before running the code, it is necessary to download in the *Data* folder the
databases used in this analysis:

- SARDdb (SRAG): it is possible to download directly the 2020 and 2021 csvs from
the Brazilian Health Ministry [OpenDataSUS](https://opendatasus.saude.gov.br/)
website ([SRAG 2020](https://opendatasus.saude.gov.br/dataset/srag-2020) and
[SRAG 2021](https://opendatasus.saude.gov.br/dataset/srag-2021-e-2022)). After 
including these files, it is necessary to change lines 65 and 67 of the [filter_SRAG.py](Code/filter_SRAG.py)
file to run the SRAG data cleansing code correctly. It is important to point out
that some values may differ slightly from the reported ones due updates and 
revisions in the original database.

- FSdb (SG): It is necessary to get the Flu Syndrome using the 
[DataLake scripts repository](https://github.com/PAMepi/PAMepi_scripts_datalake)
The pre-processing needed for the csv used here is in the file [sindrome_gripal.ipynb](https://github.com/PAMepi/PAMepi_scripts_datalake/blob/main/Data%20etl/sindrome_gripal.ipynb). The exported csv name should be sg.csv for 
compatibility or it is necessary to change the line 21 of [SG_agrupados.py](Code/SG_agrupados.py) and
XX of file YY to comply with the chosen filename.


## Tables

### Table 1

The mild to moderate infection counts are printed when the file [SG_agrupados.py](Code/SG_agrupados.py)
is run and the severe to critical infection counts when [SRAG_agrupados.py](Code/SRAG_agrupados.py)
is run. The total counts are the sum of both.

### Table 2

The first column (vaccination in all population) code is hosted in the
[DataLake scripts repository](https://github.com/PAMepi/PAMepi_scripts_datalake),
inside the *Data etl* folder.

The data necessary to fill the three last columns (Vaccinated in SARDdb) are
printed when the code [tabela_vac_srag.py](Code/tabela_vac_srag.py) is run.
Description of the output is given in the code header.

### Sup. Table 1

This figure is made with the results exported after running [logistic_regression_SRAG_death.py](Code/logistic_regression_SRAG_death.py),
that is stored in [logit_results.csv](Results/logit_results.csv). The odd-ratio CI 95\% can be
obtained using \[exp(value - 1.96*std), exp(value + 1.96*std)\]

On the results:
- the first row, "MORTE", is actually the constant parameter b0.
- the rows with dummy entries start with the reference category (like
age group from 40 to 50 or BDI class 0, with odd=1) and has the actual category
after a "\_".

### Sup. Table 2

Same as Table 2

## Figures


### Figure 1

The data necessary for this figure is generated by running [figure1_values.py](Code/figure1_values.py)
and is exported to the Results folder.

Data for each subplot:
A. [TimeSintomasInterna.csv](Results/TimeSintomasInterna.csv)
B. [HOSP_dur.csv](Results/HOSP_dur.csv)
C. [TimeSintomasICU.csv](Results/TimeSintomasICU.csv)
D. [ICU_dur.csv](Results/ICU_dur.csv)


### Figure 2

The data for each subfigure was made with a different file, and the data 
description is explained in each code header:

A. The data was generated by [separate_ibp.py](Code/separate_ibp.py)
and exported to the files [bdi_means_h.csv](Results/bdi_means_h.csv) for the 
non-ICU plot and [bdi_means_u.csv](Results/bdi_means_u.csv) for the ICU plot.

B. The data was generated by [figures_raca_mort.py](Code/figures_raca_mort.py)
and exported to the file [fig2_ethnicity.csv](Results/fig2_ethnicity.csv).

C. The data was generated by [fig2_sex_vac.py](Code/fig2_sex_vac.py)
and exported to the files [mort_vacina_ICU.csv](Results/mort_vacina_ICU.csv) (for the ICU data)
and [mort_vacina_HOSP.csv](Results/mort_vacina_HOSP.csv) (for the non-ICU data).

D. The data was generated by the same code as Fig. 2C, but the data files are
[mort_sexo_ICU.csv](Results/mort_vacina_ICU.csv) (for the ICU data)
and [mort_sexo_HOSP.csv](Results/mort_vacina_HOSP.csv) (for the non-ICU data).

### Figure 3

Same as Sup. Table 1

### Sup. Figure 1

(ToDo: insert FS discussion)
The confirmed SARS data is printed after the script [filter_SRAG.py](Code/filter_SRAG.py) is run.

### Sup. Figure 2

The first plot is generated using the [pop_ibp.csv](Data/pop_ibp.csv) file and
the geografical locations of each municipality.
The data for the other two plots is generated by [estimate_notification.py](Code/estimate_notification.py).
The time series are saved in the folder *Results* with filenames as
Class\_X\_series.csv, with X=0,1,2,3,4 being the BDI class number in the 
respective file.

### Sup. Figure 3

The data is generated by [generate_sf3_data.py](Code/generate_sf3_data.py) as
[mean_u.csv](Results/mean_u.csv) for the ICU figure and [mean_h.csv](Results/mean_h.csv).
The figure can be generated with the routine [fig_2d_age_bdi.py](Code/fig_2d_age_bdi.py),
that exports pngs files for each plot in this figure: one for the [ICU](Figures/contour_ICU_mortality.png)
and the other for [non-ICU](Figures/contour_HOSP_mortality.png).

### Sup. Figure 4

It is generated with the same files of Sup. Figure 2

### Sup. Figure 5

The file [view_death_dur_stay.py](Code/view_death_dur_stay.py) generates
both the [figure](Figures/SFig5.png) and the data [file](Results/mort_dur_hosp.csv) needed to reproduce it.

### Sup. Figure 6

The data is generated by the same code as Figure 1, in the file [TimeSintomasMorte.csv](Results/TimeSintomasMorte.csv)

# Data Cleansing

## SARDdb (SRAG)

ToDo

## FSdb (SG)

ToDo

## Vaccination db

ToDo

# Dependencies

Models were implemented using Python > 3.5 and depend on libraries such as [Pandas](https://github.com/pandas-dev/pandas), [SciPy](https://github.com/scipy/scipy), [Numpy](https://github.com/numpy/numpy) and [Matplotlib](https://github.com/matplotlib/matplotlib) 


# Citing this work

Platform For Analytical Modelis in Epidemiology. (2022). PAMEpi-Reproducibility-of-published-results (v1.0). Zenodo. https://doi.org/10.5281/zenodo.6385254

